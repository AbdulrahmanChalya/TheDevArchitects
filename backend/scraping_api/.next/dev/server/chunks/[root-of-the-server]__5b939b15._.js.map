{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/jessebui/Documents/Code/Capstone/TheDevArchitects/backend/scraping_api/lib/expediaAttractions.ts"],"sourcesContent":["// lib/expedia.ts\n\nexport type ExpediaAttractionsUrlParams = {\n  city: string;\n  startDate?: string; \n  endDate?: string; \n  adults?: number; \n};\n\nfunction encodeDateForExpedia(date?: string | null) {\n  if (!date) return \"\";\n  return date;\n}\n\nexport function buildExpediaAttractionsSearchUrl({\n  city,\n  startDate,\n  endDate,\n  adults = 2,\n}: ExpediaAttractionsUrlParams): string {\n  const base = \"https://www.expedia.ca/things-to-do/search\";\n\n  const params = new URLSearchParams();\n\n  // Location\n  if (city) {\n    params.set(\"location\", city);\n  }\n\n  // Dates\n  if (startDate) params.set(\"startDate\", encodeDateForExpedia(startDate));\n  if (endDate) params.set(\"endDate\", encodeDateForExpedia(endDate));\n\n  // People: Expedia sometimes uses travellers/adults â€“ this works in practice.\n  params.set(\"travellers\", String(adults));\n  params.set(\"sort\", \"RECOMMENDED\");\n  params.set(\"filter.seeAll\", \"true\");\n\n  return `${base}?${params.toString()}`;\n}\n"],"names":[],"mappings":"AAAA,iBAAiB;;;;;AASjB,SAAS,qBAAqB,IAAoB;IAChD,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO;AACT;AAEO,SAAS,iCAAiC,EAC/C,IAAI,EACJ,SAAS,EACT,OAAO,EACP,SAAS,CAAC,EACkB;IAC5B,MAAM,OAAO;IAEb,MAAM,SAAS,IAAI;IAEnB,WAAW;IACX,IAAI,MAAM;QACR,OAAO,GAAG,CAAC,YAAY;IACzB;IAEA,QAAQ;IACR,IAAI,WAAW,OAAO,GAAG,CAAC,aAAa,qBAAqB;IAC5D,IAAI,SAAS,OAAO,GAAG,CAAC,WAAW,qBAAqB;IAExD,6EAA6E;IAC7E,OAAO,GAAG,CAAC,cAAc,OAAO;IAChC,OAAO,GAAG,CAAC,QAAQ;IACnB,OAAO,GAAG,CAAC,iBAAiB;IAE5B,OAAO,GAAG,KAAK,CAAC,EAAE,OAAO,QAAQ,IAAI;AACvC","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/parsing/expediaAttractionsCustomParser.json"],"sourcesContent":["{\"attractions\":{\"_fns\":[{\"_fn\":\"xpath\",\"_args\":[\"//*[@data-testid='activity-tile-card']\"]}],\"_items\":{\"name\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//h3[@data-testid='activity-tile-card--title']/text()\"]}]},\"image\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//div[@data-testid='activity-tile-card-img']//img/@src\"]}]},\"duration\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//div[@data-testid='activity-duration--feature']//span[@aria-hidden='true']/text()\",\".//div[@data-testid='activity-duration--feature']//span[@class='is-visually-hidden']/text()\"]}]},\"ratingScore\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//div[@data-testid='activity-highlight-review']//span[contains(@class,'uitk-badge-base-text')]/text()\"]}]},\"ratingText\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//div[@data-testid='activity-highlight-review']//div[contains(@class,'uitk-text-emphasis-theme')]/text()\"]}]},\"reviewCount\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//div[@data-testid='activity-highlight-review']//div[contains(text(),'review')]/text()\"]},{\"_fn\":\"amount_from_string\"}]},\"priceText\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//span[contains(@class,'uitk-price-a11y')]/text()\"]}]},\"price\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//span[contains(@class,'uitk-price-a11y')]/text()\"]},{\"_fn\":\"amount_from_string\"}]},\"link\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//a[@data-testid='card-link']/@href\"]}]}}}}"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 74, "column": 1394}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///Users/jessebui/Documents/Code/Capstone/TheDevArchitects/backend/scraping_api/app/api/attractions/route.ts"],"sourcesContent":["// app/api/attractions/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { buildExpediaAttractionsSearchUrl } from \"../../../lib/expediaAttractions\";\nimport { AttractionSummary } from \"../../../types/attraction\";\nimport expediaAttractionsParser from \"../../../parsing/expediaAttractionsCustomParser.json\";\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n\n    const city = searchParams.get(\"city\") || \"\";\n    const startDate = searchParams.get(\"startDate\") || \"\";\n    const endDate = searchParams.get(\"endDate\") || \"\";\n    const people = Number(searchParams.get(\"people\") || 2);\n\n    const expediaSearchUrl = buildExpediaAttractionsSearchUrl({\n      city,\n      startDate,\n      endDate,\n      adults: people,\n    });\n\n    const username = process.env.OXYLABS_USERNAME;\n    const password = process.env.OXYLABS_PASSWORD;\n\n    if (!username || !password) {\n      return NextResponse.json(\n        {\n          error: \"Missing OXYLABS_USERNAME or OXYLABS_PASSWORD env vars\",\n        },\n        { status: 500 }\n      );\n    }\n\n    const authToken = Buffer.from(`${username}:${password}`).toString(\"base64\");\n\n    const payload = {\n      source: \"universal\",\n      url: expediaSearchUrl,\n      render: \"html\",\n      parse: true,\n      parsing_instructions: expediaAttractionsParser,\n      browser_instructions: [\n        {\n          type: \"scroll_to_bottom\",\n          timeout_s: 30,\n          wait_time_s: 20,\n        },\n      ],\n    };\n\n    const res = await fetch(\"https://realtime.oxylabs.io/v1/queries\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Basic ${authToken}`,\n      },\n      // Optional caching hint for Next.js route handler\n      // next: {\n      //   revalidate: 60 * 60, // cache for 1 hour\n      // },\n      body: JSON.stringify(payload),\n    });\n\n    if (!res.ok) {\n      const text = await res.text();\n      console.error(\"Oxylabs error:\", res.status, text);\n      return NextResponse.json(\n        {\n          error: \"Oxylabs error\",\n          status: res.status,\n          details: text,\n        },\n        { status: res.status }\n      );\n    }\n\n    const data = await res.json();\n    const content = data?.results?.[0]?.content;\n    const attractionsRaw = content?.attractions ?? [];\n\n    const attractions: AttractionSummary[] = (attractionsRaw as any[]).map(\n      (a, index) => ({\n        id: `attraction-${index + 1}`,\n        name: a.name,\n\n        ratingScore: a.ratingScore || null,\n        ratingText: a.ratingText || null,\n        reviewCount: typeof a.reviewCount === \"number\" ? a.reviewCount : null,\n\n        distance: a.distance || null,\n        duration: a.duration || null,\n\n        price: typeof a.price === \"number\" ? a.price : null,\n        priceText: a.priceText || null,\n\n        image: a.image || null,\n      })\n    );\n\n    return NextResponse.json({ attractions, expediaSearchUrl });\n  } catch (err: any) {\n    console.error(\"Attractions API error:\", err);\n    return NextResponse.json(\n      { error: \"Server failed\", detail: err.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"AAAA,+BAA+B;;;;;AAC/B;AACA;AAEA;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QAExC,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW;QACzC,MAAM,YAAY,aAAa,GAAG,CAAC,gBAAgB;QACnD,MAAM,UAAU,aAAa,GAAG,CAAC,cAAc;QAC/C,MAAM,SAAS,OAAO,aAAa,GAAG,CAAC,aAAa;QAEpD,MAAM,mBAAmB,IAAA,+JAAgC,EAAC;YACxD;YACA;YACA;YACA,QAAQ;QACV;QAEA,MAAM,WAAW,QAAQ,GAAG,CAAC,gBAAgB;QAC7C,MAAM,WAAW,QAAQ,GAAG,CAAC,gBAAgB;QAE7C,IAAI,CAAC,YAAY,CAAC,UAAU;YAC1B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OAAO;YACT,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,OAAO,IAAI,CAAC,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE,QAAQ,CAAC;QAElE,MAAM,UAAU;YACd,QAAQ;YACR,KAAK;YACL,QAAQ;YACR,OAAO;YACP,sBAAsB,4HAAwB;YAC9C,sBAAsB;gBACpB;oBACE,MAAM;oBACN,WAAW;oBACX,aAAa;gBACf;aACD;QACH;QAEA,MAAM,MAAM,MAAM,MAAM,0CAA0C;YAChE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,eAAe,CAAC,MAAM,EAAE,WAAW;YACrC;YACA,kDAAkD;YAClD,UAAU;YACV,6CAA6C;YAC7C,KAAK;YACL,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,QAAQ,KAAK,CAAC,kBAAkB,IAAI,MAAM,EAAE;YAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,QAAQ,IAAI,MAAM;gBAClB,SAAS;YACX,GACA;gBAAE,QAAQ,IAAI,MAAM;YAAC;QAEzB;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,UAAU,MAAM,SAAS,CAAC,EAAE,EAAE;QACpC,MAAM,iBAAiB,SAAS,eAAe,EAAE;QAEjD,MAAM,cAAmC,AAAC,eAAyB,GAAG,CACpE,CAAC,GAAG,QAAU,CAAC;gBACb,IAAI,CAAC,WAAW,EAAE,QAAQ,GAAG;gBAC7B,MAAM,EAAE,IAAI;gBAEZ,aAAa,EAAE,WAAW,IAAI;gBAC9B,YAAY,EAAE,UAAU,IAAI;gBAC5B,aAAa,OAAO,EAAE,WAAW,KAAK,WAAW,EAAE,WAAW,GAAG;gBAEjE,UAAU,EAAE,QAAQ,IAAI;gBACxB,UAAU,EAAE,QAAQ,IAAI;gBAExB,OAAO,OAAO,EAAE,KAAK,KAAK,WAAW,EAAE,KAAK,GAAG;gBAC/C,WAAW,EAAE,SAAS,IAAI;gBAE1B,OAAO,EAAE,KAAK,IAAI;YACpB,CAAC;QAGH,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAa;QAAiB;IAC3D,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAiB,QAAQ,IAAI,OAAO;QAAC,GAC9C;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}