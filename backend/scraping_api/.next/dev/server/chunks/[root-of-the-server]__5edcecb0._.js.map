{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/jessebui/Documents/Code/Capstone/TheDevArchitects/backend/scraping_api/lib/expedia.ts"],"sourcesContent":["export interface ExpediaSearchParams {\n  city: string;\n  startDate: string;\n  endDate: string;\n  totalGuests: number;\n  rooms: number;\n}\n\nexport function buildExpediaSearchUrl({\n  city,\n  startDate,\n  endDate,\n  totalGuests,\n  rooms,\n}: ExpediaSearchParams): string {\n  const baseURL = \"https://www.expedia.ca/Hotel-Search\";\n\n  const adultsPerRoom = Math.max(1, Math.ceil(totalGuests / rooms));\n  const adultsList = Array.from({ length: rooms }, () => adultsPerRoom).join(\n    \",\"\n  );\n\n  const params = new URLSearchParams({\n    destination: city,\n    d1: startDate,\n    d2: endDate,\n    startDate,\n    endDate,\n    adults: adultsList,\n    rooms: String(rooms),\n  });\n\n  return `${baseURL}?${params.toString()}`;\n}\n"],"names":[],"mappings":";;;;AAQO,SAAS,sBAAsB,EACpC,IAAI,EACJ,SAAS,EACT,OAAO,EACP,WAAW,EACX,KAAK,EACe;IACpB,MAAM,UAAU;IAEhB,MAAM,gBAAgB,KAAK,GAAG,CAAC,GAAG,KAAK,IAAI,CAAC,cAAc;IAC1D,MAAM,aAAa,MAAM,IAAI,CAAC;QAAE,QAAQ;IAAM,GAAG,IAAM,eAAe,IAAI,CACxE;IAGF,MAAM,SAAS,IAAI,gBAAgB;QACjC,aAAa;QACb,IAAI;QACJ,IAAI;QACJ;QACA;QACA,QAAQ;QACR,OAAO,OAAO;IAChB;IAEA,OAAO,GAAG,QAAQ,CAAC,EAAE,OAAO,QAAQ,IAAI;AAC1C","debugId":null}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/parsing/expediaCustomParser.json"],"sourcesContent":["{\"hotels\":{\"_fns\":[{\"_fn\":\"xpath\",\"_args\":[\"//*[@data-stid='property-listing-results']//*[@data-stid='lodging-card-responsive']\",\"//*[@data-stid='lodging-card-responsive']\"]}],\"_items\":{\"name\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//h3[contains(@class,'uitk-heading')]/text()\",\".//*[@data-stid='content-hotel-title']/text()\"]}]},\"ratingScore\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//div[contains(@class,'uitk-card-content-section')]//span[contains(@class,'uitk-badge-base-text')]/text()\"]}]},\"ratingText\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//div[contains(@class,'uitk-card-content-section')]//span[contains(@class,'uitk-text') and contains(@class,'uitk-type-medium')]/text()\"]}]},\"pricePerNight\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//span[@data-stid='price-lockup-text']/text()\",\".//div[contains(@class,'uitk-type-500')]/text()\"]}]},\"totalPrice\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//*[@data-test-id='price-summary']//div[contains(@class,'uitk-type-end') and contains(text(),'total')]/text()\",\".//*[@data-test-id='price-summary-message-line']//div[contains(text(),'total')]/text()\",\".//div[contains(@class,'uitk-type-end')][contains(text(),'total')]/text()\"]}]},\"images\":{\"_fns\":[{\"_fn\":\"xpath\",\"_args\":[\".//*[@data-stid='lodging-card-media-section']//img[contains(@class,'uitk-image-media')]/@src\",\".//*[@data-stid='lodging-card-media-section']//img[contains(@class,'uitk-image-media')]/@data-src\",\".//div[contains(@class,'uitk-gallery-carousel-items')]//img[contains(@class,'uitk-image-media')]/@src\",\".//div[contains(@class,'uitk-gallery-carousel-items')]//img[contains(@class,'uitk-image-media')]/@data-src\",\".//img[contains(@class,'uitk-image-media')]/@src\",\".//img[contains(@class,'uitk-image-media')]/@data-src\"]}]},\"amenities\":{\"_fns\":[{\"_fn\":\"xpath\",\"_args\":[\".//ul[contains(@class,'uitk-typelist') and contains(@class,'uitk-typelist-size-2')]//div[contains(@class,'uitk-text')]/text()\",\".//ul[contains(@class,'uitk-typelist')]//li//div[contains(@class,'uitk-text')]/text()\"]}]},\"reviewCount\":{\"_fns\":[{\"_fn\":\"xpath_one\",\"_args\":[\".//span[contains(@class,'uitk-text') and contains(@class,'uitk-type-200') and contains(., 'review')]/text()\"]},{\"_fn\":\"amount_from_string\"}]}}}}"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 70, "column": 2222}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Users/jessebui/Documents/Code/Capstone/TheDevArchitects/backend/scraping_api/app/api/hotels/route.ts"],"sourcesContent":["import { buildExpediaSearchUrl } from \"../../../lib/expedia\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\nimport expediaParsingInstructions from \"../../../parsing/expediaCustomParser.json\";\nimport { HotelSummary } from \"../../../types/hotel\";\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n\n    const city = searchParams.get(\"city\") || \"\";\n    const startDate = searchParams.get(\"startDate\") || \"\";\n    const endDate = searchParams.get(\"endDate\") || \"\";\n    const people = Number(searchParams.get(\"people\") || 2);\n    const rooms = Number(searchParams.get(\"rooms\") || 1);\n\n    const expediaSearchUrl = buildExpediaSearchUrl({\n      city,\n      startDate,\n      endDate,\n      totalGuests: people,\n      rooms,\n    });\n\n    const username = process.env.OXYLABS_USERNAME;\n    const password = process.env.OXYLABS_PASSWORD;\n\n    // if (!username || !password) {\n    //   // This is a VERY common reason for 500\n    //   return NextResponse.json(\n    //     { error: \"Missing OXYLABS_USERNAME or OXYLABS_PASSWORD env vars\" },\n    //     { status: 500 }\n    //   );\n    // }\n\n    const authToken = Buffer.from(`${username}:${password}`).toString(\"base64\");\n\n    const payload = {\n      source: \"universal\",\n      url: expediaSearchUrl,\n      render: \"html\",\n      parse: true,\n      parsing_instructions: expediaParsingInstructions,\n      browser_instructions: [\n        {\n          type: \"scroll_to_bottom\",\n          timeout_s: 5,\n          wait_time_s: 5,\n        },\n      ],\n    };\n\n    const res = await fetch(\"https://realtime.oxylabs.io/v1/queries\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Basic ${authToken}`,\n      },\n      body: JSON.stringify(payload),\n    });\n    // const contentType = res.headers.get(\"content-type\") || \"\";\n\n    if (!res.ok) {\n      const text = await res.text();\n      console.error(\"Oxylabs error:\", res.status, text);\n      return NextResponse.json(\n        { error: \"Oxylabs error\", status: res.status, details: text },\n        { status: res.status }\n      );\n    }\n\n    // if (!contentType.includes(\"application/json\")) {\n    //   const text = await res.text();\n    //   console.error(\"Oxylabs non-JSON response:\", text);\n    //   return NextResponse.json(\n    //     {\n    //       error: \"Oxylabs did not return JSON\",\n    //       details: text.slice(0, 500), // first 500 chars for debugging\n    //     },\n    //     { status: 502 }\n    //   );\n    // }\n\n    const data = await res.json();\n\n    // const result = data?.results?.[0];\n    // console.log(\"parse_status_code:\", result?.content?.parse_status_code);\n    // console.log(\n    //   \"parser warnings:\",\n    //   JSON.stringify(result?.content?._warnings, null, 2)\n    // );\n    // console.log(\n    //   \"hotels from parser:\",\n    //   Array.isArray(result?.content?.hotels)\n    //     ? result.content.hotels.length\n    //     : result?.content?.hotels\n    // );\n\n    const content = data.results?.[0]?.content;\n    const hotelsRaw = content?.hotels ?? [];\n\n    const hotels: HotelSummary[] = hotelsRaw.map((h: any, index: number) => ({\n      id: `hotel-${index + 1}`,\n      name: h.name,\n      ratingText: h.ratingText || undefined,\n      ratingScore: h.ratingScore || undefined,\n      pricePerNight: h.pricePerNight || undefined,\n      totalPrice: h.totalPrice || undefined,\n      images:\n        Array.isArray(h.images) && h.images.length > 0 ? h.images : undefined,\n      amenities: Array.isArray(h.amenities) ? h.amenities : undefined,\n      reviewCount:\n        typeof h.reviewCount === \"number\" ? h.reviewCount : undefined,\n    }));\n\n    return NextResponse.json({ hotels, expediaSearchUrl });\n  } catch (err: any) {\n    return NextResponse.json(\n      { error: \"Server failed\", detail: err.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}