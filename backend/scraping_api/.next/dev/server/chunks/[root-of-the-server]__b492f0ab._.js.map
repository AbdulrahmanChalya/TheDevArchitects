{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/jessebui/Documents/Code/Capstone/TheDevArchitects/backend/scraping_api/app/api/attractions/route.ts"],"sourcesContent":["// app/api/attractions/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { buildExpediaAttractionsSearchUrl } from \"../../lib/expediaAttractions\";\nimport { AttractionSummary } from \"../../types/attraction\";\nimport expediaAttractionsParser from \"../../parsing/expediaAttractionsCustomParser.json\";\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n\n    const city = searchParams.get(\"city\") || \"\";\n    const startDate = searchParams.get(\"startDate\") || \"\";\n    const endDate = searchParams.get(\"endDate\") || \"\";\n    const people = Number(searchParams.get(\"people\") || 2);\n\n    const expediaSearchUrl = buildExpediaAttractionsSearchUrl({\n      city,\n      startDate,\n      endDate,\n      adults: people,\n    });\n\n    const username = process.env.OXYLABS_USERNAME;\n    const password = process.env.OXYLABS_PASSWORD;\n\n    if (!username || !password) {\n      return NextResponse.json(\n        {\n          error: \"Missing OXYLABS_USERNAME or OXYLABS_PASSWORD env vars\",\n        },\n        { status: 500 }\n      );\n    }\n\n    const authToken = Buffer.from(`${username}:${password}`).toString(\"base64\");\n\n    const payload = {\n      source: \"universal\",\n      url: expediaSearchUrl,\n      render: \"html\",\n      parse: true,\n      parsing_instructions: expediaAttractionsParser,\n      browser_instructions: [\n        {\n          type: \"scroll_to_bottom\",\n          timeout_s: 30,\n          wait_time_s: 20,\n        },\n      ],\n    };\n\n    const res = await fetch(\"https://realtime.oxylabs.io/v1/queries\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Basic ${authToken}`,\n      },\n      // Optional caching hint for Next.js route handler\n      // next: {\n      //   revalidate: 60 * 60, // cache for 1 hour\n      // },\n      body: JSON.stringify(payload),\n    });\n\n    if (!res.ok) {\n      const text = await res.text();\n      console.error(\"Oxylabs error:\", res.status, text);\n      return NextResponse.json(\n        {\n          error: \"Oxylabs error\",\n          status: res.status,\n          details: text,\n        },\n        { status: res.status }\n      );\n    }\n\n    const data = await res.json();\n    const content = data?.results?.[0]?.content;\n    const attractionsRaw = content?.attractions ?? [];\n\n    const attractions: AttractionSummary[] = (attractionsRaw as any[]).map(\n      (a, index) => ({\n        id: `attraction-${index + 1}`,\n        name: a.name,\n\n        ratingScore: a.ratingScore || null,\n        ratingText: a.ratingText || null,\n        reviewCount: typeof a.reviewCount === \"number\" ? a.reviewCount : null,\n\n        distance: a.distance || null,\n        duration: a.duration || null,\n\n        price: typeof a.price === \"number\" ? a.price : null,\n        priceText: a.priceText || null,\n\n        image: a.image || null,\n      })\n    );\n\n    return NextResponse.json({ attractions, expediaSearchUrl });\n  } catch (err: any) {\n    console.error(\"Attractions API error:\", err);\n    return NextResponse.json(\n      { error: \"Server failed\", detail: err.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"AAAA,+BAA+B;;;;;AAC/B;;;;;;;;;;;;;;AAKO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QAExC,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW;QACzC,MAAM,YAAY,aAAa,GAAG,CAAC,gBAAgB;QACnD,MAAM,UAAU,aAAa,GAAG,CAAC,cAAc;QAC/C,MAAM,SAAS,OAAO,aAAa,GAAG,CAAC,aAAa;QAEpD,MAAM,mBAAmB,iCAAiC;YACxD;YACA;YACA;YACA,QAAQ;QACV;QAEA,MAAM,WAAW,QAAQ,GAAG,CAAC,gBAAgB;QAC7C,MAAM,WAAW,QAAQ,GAAG,CAAC,gBAAgB;QAE7C,IAAI,CAAC,YAAY,CAAC,UAAU;YAC1B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OAAO;YACT,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,OAAO,IAAI,CAAC,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE,QAAQ,CAAC;QAElE,MAAM,UAAU;YACd,QAAQ;YACR,KAAK;YACL,QAAQ;YACR,OAAO;YACP,sBAAsB;YACtB,sBAAsB;gBACpB;oBACE,MAAM;oBACN,WAAW;oBACX,aAAa;gBACf;aACD;QACH;QAEA,MAAM,MAAM,MAAM,MAAM,0CAA0C;YAChE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,eAAe,CAAC,MAAM,EAAE,WAAW;YACrC;YACA,kDAAkD;YAClD,UAAU;YACV,6CAA6C;YAC7C,KAAK;YACL,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,QAAQ,KAAK,CAAC,kBAAkB,IAAI,MAAM,EAAE;YAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,QAAQ,IAAI,MAAM;gBAClB,SAAS;YACX,GACA;gBAAE,QAAQ,IAAI,MAAM;YAAC;QAEzB;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,UAAU,MAAM,SAAS,CAAC,EAAE,EAAE;QACpC,MAAM,iBAAiB,SAAS,eAAe,EAAE;QAEjD,MAAM,cAAmC,AAAC,eAAyB,GAAG,CACpE,CAAC,GAAG,QAAU,CAAC;gBACb,IAAI,CAAC,WAAW,EAAE,QAAQ,GAAG;gBAC7B,MAAM,EAAE,IAAI;gBAEZ,aAAa,EAAE,WAAW,IAAI;gBAC9B,YAAY,EAAE,UAAU,IAAI;gBAC5B,aAAa,OAAO,EAAE,WAAW,KAAK,WAAW,EAAE,WAAW,GAAG;gBAEjE,UAAU,EAAE,QAAQ,IAAI;gBACxB,UAAU,EAAE,QAAQ,IAAI;gBAExB,OAAO,OAAO,EAAE,KAAK,KAAK,WAAW,EAAE,KAAK,GAAG;gBAC/C,WAAW,EAAE,SAAS,IAAI;gBAE1B,OAAO,EAAE,KAAK,IAAI;YACpB,CAAC;QAGH,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAa;QAAiB;IAC3D,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAiB,QAAQ,IAAI,OAAO;QAAC,GAC9C;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}